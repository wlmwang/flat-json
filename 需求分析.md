# 需求背景
1. 面对B端复杂多变的需求，后端需要能够快速响应
> 即：需求发生变更，需要增、减字段时，后端应能够透明、或最小化配置

# 需求分析
1. 提供一个附带了能够保存JSON数据字段的对象实体（对象实体：对应数据表中一条记录）
   * 将前端提交的表单数据（键值对），除了能够直接映射到该对象实体常规字段外，剩余的部分全部自动编码为JSON结构数据映射到该JSON字段中，一并存储在数据库中
   * 当前端查询该对象实体的记录时，数据库中的JSON字段中保存的键值对能够自动解码，并对外平铺成一个常规字段，编码成JSON接口供REST接口返回
   * 总结：数据库、对象实体中的JSON字段对外接口是透明的
2. 保存在JSON字段中的数据，参与自定义搜索；并可排序（排序字段需数字类型）
   * 字符串类型字段：精确匹配、模糊匹配
   * 数字类型字段：精确匹配、范围匹配
   * 数组类型字段：包含匹配（元素为字符串：精确匹配、模糊匹配；元素为数字时：精确匹配）
   * 对象类型字段：使用el表达式？？？
3. 自动适配JSON字段映射的虚拟列
   * 当保存在JSON字段中JSON数据，被非常频繁的使用在搜索条件时，可以为其建立虚拟列、创建索引，要能自动适配
4. 由于JSON字段较为松散，希望能够在保存数据集时提供约束功能？？？
   * 校验指定字段是否必须
   * 校验指定字段数据类型：number、string、array、object
   * 可快速启停以上所有约束功能
5. JSON字段中键值能够提供别名功能？？？

# 技术方案
1. 持久层
   * 使用数据库的JSON字段类型、varchar+json函数
   * 至少支持Mysql、Postgres，完成其功能测试
2. 前端 - 拥有所有字段的最终解释权
   * 支持form body、json body提交对象实体
   * 对form+json column表单域提交，不特殊场景不支持，但后端会提供快速开发能力。其实没必要！！！
3. Java后端
   * 将支持JSON字段的实体类，使用注解：@JsonPackEntity(field='columnName')，@TableName(autoResultMap = true)
   * 同时，将该实体类中实际的映射为JSON字段的类属性，使用注解：@TableField(typeHandler = JacksonTypeHandler.class)
     * 无必须要求外，请务必将该类属性字段定义为Map<String, Object>
       * String支持处理，场景可能只适用于：定义的实体已与现有系统强耦合，并且修改起来成本较高。但注意，使用了该兼容方案，该JSON字段中的数据将无法使用搜索功能
4. 后端侧详细设计
   * 使用自定义SpringMVC HttpMessageConverter，实现form数据到java bean转换
   * 使用自定义@JsonPackEntity、@JsonPackField，开启附带JSON字段的实体
   * 使用自定义Mybatis Interceptor，实现不同数据库的字段搜索功能

# 未来路线
1. 支持JSON字段约束
2. 支持JSON字段别名
3. 支持更多数据库
